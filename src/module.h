#ifndef MODULE_H
#define MODULE_H

////////////////////////////////////////////////////////////////////////////////
//
// Includes
//
#ifndef INTERRUPT_H
#	include "interrupt.h"
#endif

#ifndef OPERATION_H
#	include "operation.h"
#endif


// STD Includes
#include <map>
#include <string>
#include <vector>
#include <memory>
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
namespace medusa {
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//
// class CModule
//
class CModule
{
public:// Constructors
	CModule(std::string const& strModulePath);
	~CModule() = default;

public:// Interface Methodes
	inline EOpCode GetOpCode(int nOffset) const;

	inline int GetArgument(int nOffset) const;

	inline int GetSize() const;

private:// Members
	std::vector<EOpCode> m_arrOpCode;
	std::vector<int> m_arrArgument;
};
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//
// class CModuleManager
//
class CModuleManager
{
public:// Constructors
	inline CModuleManager();
	inline ~CModuleManager() = default;

public:// Interface Methodes
	std::shared_ptr<CModule> Load(std::string const& strModulePath);

protected:// Helper Functions

private:// Members
	std::map< std::string, std::shared_ptr<CModule> > m_mapPathToModule;
};
////////////////////////////////////////////////////////////////////////////////

///////////////////////// Implementing inline methods //////////////////////////

////////////////////////////////////////////////////////////////////////////////
//
// class CModule
//

// Interface Methodes
inline EOpCode CModule::GetOpCode(int nOffset) const
{
	if (nOffset >= m_arrOpCode.size())
		return m_arrOpCode[m_arrOpCode.size() - 1];
	return m_arrOpCode[nOffset];
}

inline int CModule::GetArgument(int nOffset) const
{
	return m_arrArgument[nOffset];
}

inline int CModule::GetSize() const
{
	return m_arrOpCode.size();
}

////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//
// class CModule
//

// Constructors
inline CModuleManager::CModuleManager()
	: m_mapPathToModule()
{
}

////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
} // namespace medusa
////////////////////////////////////////////////////////////////////////////////


#endif // MODULE_H